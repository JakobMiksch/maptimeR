---
title: "Intro to spatial vector data analysis with R"
author: "Luuk van der Meer & Lorena Abad"
date: "20.02.2020"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 2 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Getting started 

First things first. Let's install the basic spatial packages we will use:

```{r install, eval = F}
install.packages(c('sf','tmap','mapview'))
```

***
**_Note:_** A nice thing about R and its packages is that the documentation is always available. If you want to know how a function works, just type `?` in front of any function on the console, and you will get the `Help` page for it. e.g. `?download.file`.

***

## Download and Read
```{r download, eval = F}
download.file(
  'https://www.salzburg.gv.at/ogd/7b5df951-b8b0-4153-b599-490b4fe39d8b/Burgen_und_Schloesser_Shapefile.zip', 
  destfile = '../temp/burgen.zip'
)
unzip('../temp/burgen.zip', exdir = '../temp')
```

To read and manipulate vector data in R, we will use the [`sf`](https://r-spatial.github.io/sf/){target="_blank"} package. 
```{r read}
library(sf)
schloss = read_sf('../temp/Burgen_und_Schloesser/Burgen_und_Schloesser.shp')
```

***
**_Note:_** `sf` uses GDAL as a base, and can read from different drivers, type `sf::st_drivers()` on your console to see a list of all supported formats. It also supports loading data from databases and directly from URLs. Here is a [cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/sf.pdf) on the main functions of `sf`.

***

## Explore data
```{r explore}
head(schloss)
st_crs(schloss) ## looks like EPSG:31258 - MGI / Austria GK M31
dim(schloss)
st_geometry(schloss)
plot(st_geometry(schloss)) ## This will plot only the geometry and not every attribute. Try also `plot(schloss)`
```

## Interactive exploration

The [`mapview`](https://r-spatial.github.io/mapview/) package is a great option to fastly explore your data with one line of code. Click on a point and check the attributes!

```{r interactive}
library(mapview)
mapview(schloss, map.type = "OpenStreetMap")
```

## Hands on time!

Now it is your turn, explore the datasets on links below. Check on the extension of the datasets, and think about the easier way to import it (check the notes!). 

* https://www.salzburg.gv.at/ogd/a5841caf-afe2-4f98-bb68-bd4899e8c9cb/Museen.json

* http://data.statistik.gv.at/data/OGDEXT_GEM_1_STATISTIK_AUSTRIA_20200101.zip

Load it into R and explore the data. We will integrate these datasets with the `schloss` dataset later, so here are some trick questions:

* What do the datasets have in common? Do they have similar attributes?

* What are immediate challenges you identify for merging/joining the data?

* Try to intersect two of the datasets. What happened? 
    + Hint: use `st_intersection`
